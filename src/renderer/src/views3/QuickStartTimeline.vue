<template>
  <v-container>
    <!-- Âä®ÊÄÅÂä†ËΩΩÁä∂ÊÄÅÔºöÊòæÁ§∫‰∏Ä‰∏™ÂÜÖÁΩÆÂä®ÁîªÁöÑSVGÂä®ÊÄÅÂä†ËΩΩÂõæ -->
    <template v-if="loading">
      <div class="loading-container">
        <img :src="dynamicLoadingSvg" alt="Âä†ËΩΩÂä®Áîª" class="loading-svg" />
      </div>
    </template>

    <!-- Ê≠£Â∏∏ÊòæÁ§∫Êó∂Èó¥ËΩ¥ -->
    <template v-else>
      <v-app>
        <v-timeline density="compact">
          <template v-for="(step, index) in steps" :key="index">
            <v-timeline-item :dot-color="step.color" :icon="step.icon">
              <v-card variant="flat" class="pa-2">
                <v-card-title class="headline">
                  {{ step.title }}
                </v-card-title>
                <v-card-text v-if="step.description">
                  {{ step.description }}
                </v-card-text>

                <!-- Â≠êÊµÅÁ®ãÈ°πÂ±ïÁ§∫ -->
                <template v-if="step.subSteps && step.subSteps.length">
                  <div style="min-width: 900px; max-width: 900px">
                    <v-divider class="my-3" />
                    <v-stepper v-model="step.currentStep" class="elevation-0">
                      <v-stepper-header class="elevation-0">
                        <template
                          v-for="(subStep, subIndex) in step.subSteps"
                          :key="subIndex"
                        >
                          <v-stepper-item
                            :value="subIndex + 1"
                            :complete="step.currentStep > subIndex + 1"
                            @click="selectSubStep(step, subStep)"
                            class="cursor-pointer"
                            editable
                          >
                            <template #title>
                              <div class="d-flex align-center">
                                <v-icon size="small" class="mr-1">
                                  {{
                                    subStep.icon ||
                                    'mdi-checkbox-blank-circle-outline'
                                  }}
                                </v-icon>
                                <span>{{ subStep.title }}</span>
                              </div>
                            </template>
                          </v-stepper-item>
                          <v-divider
                            v-if="subIndex < step.subSteps.length - 1"
                            :key="'divider-' + subIndex"
                          />
                        </template>
                      </v-stepper-header>
                    </v-stepper>
                    <!-- Â≠êÊ≠•È™§ÊèèËø∞Â±ïÁ§∫Âå∫Âüü -->
                    <v-card-text
                      v-if="step.selectedSubStep && step.selectedSubStep.description"
                      class="mt-3 bg-grey-lighten-4 rounded"
                    >
                      {{ step.selectedSubStep.description }}
                    </v-card-text>
                  </div>
                </template>

                <!-- ÂàÜÊîØÈÄâÊã©ÈÉ®ÂàÜ -->
                <template v-if="step.branches && step.branches.length">
                  <div style="min-width: 900px; max-width: 900px">
                    <v-divider class="my-3" />
                    <v-row class="branch-options">
                      <v-col
                        v-for="(branch, branchIndex) in step.branches"
                        :key="branchIndex"
                        :cols="12 / step.branches.length"
                      >
                        <v-card
                          variant="outlined"
                          class="branch-option"
                          :class="{ selected: selectedBranch === branch.value }"
                          @click="jumpToRoute(branch.value)"
                        >
                          <v-card-text class="text-center">
                            <v-icon>{{ branch.icon }}</v-icon>
                            <div>{{ branch.title }}</div>
                          </v-card-text>
                        </v-card>
                      </v-col>
                    </v-row>
                  </div>
                </template>

                <!-- Ë∑≥ËΩ¨ÊåâÈíÆÔºàÂØπÈùûÂàÜÊîØÊ≠•È™§Ôºâ -->
                <v-card-actions v-if="step.route">
                  <v-btn color="primary" @click="jumpToRoute(step.route)">
                    ÂâçÂæÄ {{ step.buttonText || step.title }}
                  </v-btn>
                </v-card-actions>
              </v-card>
            </v-timeline-item>
          </template>
        </v-timeline>
      </v-app>
    </template>
  </v-container>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import dynamicLoadingSvg from '../assets/load.svg';

// ÈÄöËøá useRouter Ëé∑Âèñ vue-router ÂÆû‰æãÁî®‰∫éÈ°µÈù¢Ë∑≥ËΩ¨
const router = useRouter();

// ÊéßÂà∂ÊòØÂê¶Â§Ñ‰∫éÂä†ËΩΩÁä∂ÊÄÅ
const loading = ref(true);

// ÂàÜÊîØÈÄâÊã©ÔºàÂÖ®Â±ÄÔºâÁä∂ÊÄÅ
const selectedBranch = ref(null);

// ÂÆö‰πâÊó∂Èó¥ËΩ¥ÊµÅÁ®ãÈ°π
const steps = ref([
  {
    title:
      'GitGoÔºåÊòØ‰∏Ä‰∏™‰ª£Á†ÅÊô∫ËÉΩÂä©ÁêÜËΩØ‰ª∂',
    description: '‰∏ãÈù¢Êàë‰ª¨Êù•ËøõË°åÂø´ÈÄü‰ΩøÁî®ÊµÅÁ®ãüëá',
    icon: 'mdi-play',
    color: 'primary',
    // ËØ•Ê≠•È™§‰ªÖ‰Ωú‰∏∫‰ªãÁªçÔºåÊó†Â≠êÊµÅÁ®ã/Ë∑≥ËΩ¨
  },
  {
    title: '1. ‰ª£Á†Å‰ªìÂ∫ìÂàùÂßãÂåñ',
    description:
      '‰ªé‰ªª‰ΩïÂÖ¨ÁΩëÁöÑGitHub„ÄÅGiteeÔºåÊàñÂÖ¨Âè∏ÂÜÖÁΩëÁöÑGitLabÔºåÂ∞Ü‰ª£Á†Å‰ªìÂ∫ìÂØºÂÖ•Âà∞ËøôÈáå',
    icon: 'mdi-source-repository',
    color: 'success',
    currentStep: 1,
    selectedSubStep: null,
    subSteps: [
      {
        title: 'ÂàõÂª∫‰ªìÂ∫ìË∫´‰ªΩËØÅ',
        icon: 'mdi-card-account-details',
        description:
          '‰∏∫‰Ω†ÁöÑ‰ª£Á†Å‰ªìÂ∫ìÂàõÂª∫ÂîØ‰∏ÄË∫´‰ªΩÊ†áËØÜÔºå‰æø‰∫éÂêéÁª≠ÁÆ°ÁêÜÂíåËøΩË∏™',
      },
      {
        title: 'ÁîüÊàêÊï∞ÊçÆËÆ∞ÂøÜÂç°',
        icon: 'mdi-memory',
        description:
          'Âü∫‰∫é‰ªìÂ∫ìÂÜÖÂÆπÁîüÊàêÊï∞ÊçÆËÆ∞ÂøÜÂç°ÔºåÊûÑÂª∫Êô∫ËÉΩÁ¥¢ÂºïÔºåÊèêÂçáAIÁêÜËß£ÂíåÂàÜÊûêËÉΩÂäõ',
      },
    ],
    route: '/repo',
    buttonText: '‰ªìÂ∫ìÈÖçÁΩÆ',
  },
  {
    title: '2. ÈÖçÁΩÆÂ§ßÊ®°Âûã',
    description: 'ÈÖçÁΩÆÊâÄÈúÄÁöÑÊ®°ÂûãÂèÇÊï∞',
    icon: 'mdi-cog',
    color: 'info',
    branches: [
      { title: 'Á¶ªÁ∫øÊô∫ËÉΩ', value: '/model', icon: 'mdi-laptop' },
      { title: '‰∫ëÁ´ØÊô∫ËÉΩ', value: '/model', icon: 'mdi-cloud' },
    ],
  },
  {
    title: '3. ÈÖçÁΩÆÊô∫ËÉΩ‰Ωì',
    description: 'ÈÖçÁΩÆ‰Ω†ÁöÑÊô∫ËÉΩ‰ΩìÂèÇÊï∞',
    icon: 'mdi-robot',
    color: 'purple',
    currentStep: 1,
    selectedSubStep: null,
    subSteps: [
      {
        title: 'ÂÆöÂà∂Êô∫ËÉΩ‰ΩìË°å‰∏∫',
        icon: 'mdi-text-box',
        description:
          'ÂÆöÂà∂Êô∫ËÉΩ‰ΩìÁöÑË°å‰∏∫ÈÄªËæë‰∏éÈ£éÊ†ºËÆæÂÆöÔºå‰ΩøÂÆÉÊõ¥ÂÖ∑Â§áÁ¨¶ÂêàÈ°πÁõÆÁâπÁÇπÁöÑ‰∏™ÊÄßÂåñÁâπÂæÅ',
      },
      {
        title: 'ÂÆöÂà∂ÊèêÁ§∫ËØç',
        icon: 'mdi-text-box',
        description: 'ÁºñÂÜôÁ¨¶ÂêàÊô∫ËÉΩ‰ΩìË°å‰∏∫ÈÄªËæëÁöÑÊèêÁ§∫ËØçÔºåÊåáÂØºAIË°å‰∏∫',
      },
      {
        title: 'ÂèÇÊï∞ÂæÆË∞É',
        icon: 'mdi-tune',
        description:
          'Á≤æÁªÜË∞ÉÊï¥AIÊ®°ÂûãÁöÑÂèÇÊï∞ÔºåÂ¶ÇÊ∏©Â∫¶„ÄÅTop-K„ÄÅ‰∏ä‰∏ãÊñáÈïøÂ∫¶„ÄÅÈáçÂ§çÊÉ©ÁΩöÁ≠âÊ®°ÂûãÈ´òÁ∫ßÁâπÊÄßÔºå‰ºòÂåñÊô∫ËÉΩ‰ΩìË°®Áé∞„ÄÇ',
      },
    ],
    route: '/agent',
    buttonText: 'Êô∫ËÉΩ‰ΩìÁÆ°ÁêÜ',
  },
  {
    title: '4. ÂêØÂä®AIËÉΩÂäõ',
    description: 'ÂêØÂä®AIËÉΩÂäõÔºåÂºÄÂêØÊô∫ËÉΩÊúçÂä°',
    icon: 'mdi-rocket',
    color: 'red',
    branches: [
      {
        title: 'Á©∫Èó¥ÈÄèÈïú',
        value: '/space',
        icon: 'mdi-telescope',
      },
      {
        title: 'Êô∫ËÉΩÊé®ÈÄÅ',
        value: '/sender',
        icon: 'mdi-send',
      },
      {
        title: '‰ª£Á†ÅÂÆ°Êü•',
        value: '/commits',
        icon: 'mdi-robot-angry',
      },
      {
        title: 'ÂàÜÊûêÊä•Âëä',
        value: '/report',
        icon: 'mdi-microsoft-word',
      },
      {
        title: 'Ê∑±Â∫¶ÊêúÁ¥¢',
        value: '/search',
        icon: 'mdi-book-search',
      },
    ],
  },
]);

/**
 * ÈÄâÊã©ÊåáÂÆöÊµÅÁ®ã‰∏≠Êüê‰∏™Â≠êÊµÅÁ®ãÈ°π
 * @param {Object} step - ÂΩìÂâçÊµÅÁ®ãÈ°π
 * @param {Object} subStep - ÈÄâ‰∏≠ÁöÑÂ≠êÊµÅÁ®ãÈ°π
 */
function selectSubStep(step, subStep) {
  step.selectedSubStep = subStep;
}

/**
 * ‰ΩøÁî® vue-router ËøõË°åË∑ØÁî±Ë∑≥ËΩ¨
 * @param {String|Object} route - Ë∑≥ËΩ¨ÁöÑË∑ØÁî±
 */
function jumpToRoute(route) {
  router.push(route).catch((err) => {
    // ÂøΩÁï•ÈáçÂ§çÂØºËà™ÈîôËØØ
    if (err.name !== 'NavigationDuplicated') {
      console.error(err);
    }
  });
}

// ÁªÑ‰ª∂Âä†ËΩΩÊó∂Ôºö‰∏∫ÊØè‰∏™Â∏¶Â≠êÊµÅÁ®ãÁöÑÊ≠•È™§ÈÄâÊã©Á¨¨‰∏Ä‰∏™Â≠êÊµÅÁ®ãÔºåÂπ∂Á≠âÂæÖÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
onMounted(() => {
  steps.value.forEach((step) => {
    if (step.subSteps && step.subSteps.length) {
      selectSubStep(step, step.subSteps[0]);
    }
  });
  // Âà§Êñ≠È°µÈù¢ÊòØÂê¶Â∑≤ÂÆåÂÖ®Âä†ËΩΩÔºö
  if (document.readyState === 'complete') {
    loading.value = false;
  } else {
    window.addEventListener('load', () => {
      loading.value = false;
    });
  }
});
</script>

<style scoped>
/* Âä®ÊÄÅÂä†ËΩΩÂÆπÂô® */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

/* Âä®ÊÄÅÂä†ËΩΩSVGÔºà‰πüÂèØÂ¢ûÂä†Âä®ÁîªÊïàÊûúÔºâ */
.loading-svg {
  width: 80px;
  height: auto;
}

@keyframes spin {
  100% {
    transform: rotate(360deg);
  }
}

/* Êó∂Èó¥ËΩ¥„ÄÅÂàÜÊîØ‰∏éÊ≠•ËøõÂô®Ê†∑Âºè */
.v-timeline {
  margin-top: 20px;
}

.v-timeline-item {
  margin-bottom: 16px;
}

.branch-option {
  cursor: pointer;
  transition: all 0.3s;
}

.branch-option:hover {
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.branch-option.selected {
  border-color: rgb(var(--v-theme-primary));
  background-color: rgba(var(--v-theme-primary), 0.1);
}

.branch-options {
  position: relative;
}

.branch-options::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 2px;
  height: 20px;
  background-color: rgb(var(--v-theme-warning));
  transform: translate(-50%, -100%);
}

/* Stepper Ê†∑ÂºèË∞ÉÊï¥ */
.v-stepper {
  box-shadow: none !important;
}

.v-stepper__header {
  box-shadow: none !important;
}

.cursor-pointer {
  cursor: pointer;
}

.v-stepper__item {
  padding: 8px 12px;
}

.v-stepper__item:hover {
  background-color: rgba(var(--v-theme-primary), 0.1);
  border-radius: 4px;
}
</style>
